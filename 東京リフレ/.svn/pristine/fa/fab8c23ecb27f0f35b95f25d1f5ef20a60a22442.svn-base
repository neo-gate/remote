<?php


$document_root = $_SERVER['DOCUMENT_ROOT'];
define("ROOT_PATH", $document_root."/");
define("MAN_ROOT_PATH", ROOT_PATH."man/");
define("MAN_INC", MAN_ROOT_PATH."include/");
include(MAN_INC."define.php");

$attendance_id = 34619;

$data = get_attendance_staff_new_by_id($attendance_id);
$start_time = $data["start_time"];
$end_time = $data["end_time"];
echo "<pre>"; print_r($data); echo "</pre>";

//Xget_and_update_honbu_work_time_common($attendance_id,-1,-1,-1,-1,$start_time,$end_time);
Xget_and_update_driver_work_time_common($attendance_id,-1,-1,-1,-1,$start_time,$end_time);

//データのアップデート(最初のアクセス時だけ)と、データの取得
function Xget_and_update_honbu_work_time_common($attendance_id,$start_hour,$start_minute,$end_hour,$end_minute,$start_time,$end_time){

	if( ($start_hour == "-1") or ($start_minute == "-1") or ($end_hour == "-1") or ($end_minute == "-1") ){

		$time_array = get_time_array_honbu_common();	//本部スタッフ用時刻配列取得

		$time_data = get_time_value_for_sale_driver_one_common($time_array,$start_time,$end_time);	//開始及び終了時刻取得

		$start_hour = $time_data["start_hour"];
		$start_minute = $time_data["start_minute"];
		$end_hour = $time_data["end_hour"];
		$end_minute = $time_data["end_minute"];
echo $start_time . ", " . $end_time . " " . $end_hour . ":" . $end_minute . "<br />";
exit;
/*
		//売上金額の更新
		$sql = sprintf("update attendance_staff_new set start_hour='%s',start_minute='%s',end_hour='%s',end_minute='%s' where id='%s'",$start_hour,$start_minute,$end_hour,$end_minute,$attendance_id);
		$res = mysql_query($sql, DbCon);
		if($res == false){
			echo "error!(get_and_update_honbu_work_time_common)";
			exit();
		}
*/
	}

	$data["start_hour"] = $start_hour;
	$data["start_minute"] = $start_minute;
	$data["end_hour"] = $end_hour;
	$data["end_minute"] = $end_minute;

	return $data;
	exit();
}

function Xget_and_update_driver_work_time_common($attendance_id,$start_hour,$start_minute,$end_hour,$end_minute,$start_time,$end_time){

	if( ($start_hour == "-1") || ($start_minute == "-1") || ($end_hour == "-1") || ($end_minute == "-1") ){

		$staff_type = get_staff_type_by_attendance_id_common($attendance_id);
echo $staff_type . " " . COMMON_INC . "###<br />";

$time_array_driver = array(
    "1" => array("hour" => 18,"minute" => 0),
	"2" => array("hour" => 18,"minute" => 30),
	"3" => array("hour" => 19,"minute" => 0),
	"4" => array("hour" => 19,"minute" => 30),
	"5" => array("hour" => 20,"minute" => 0),
	"6" => array("hour" => 20,"minute" => 30),
	"7" => array("hour" => 21,"minute" => 0),
	"8" => array("hour" => 21,"minute" => 30),
	"9" => array("hour" => 22,"minute" => 0),
	"10" => array("hour" => 22,"minute" => 30),
	"11" => array("hour" => 23,"minute" => 0),
	"12" => array("hour" => 23,"minute" => 30),
	"13" => array("hour" => 24,"minute" => 0),
	"14" => array("hour" => 24,"minute" => 30),
	"15" => array("hour" => 25,"minute" => 0),
	"16" => array("hour" => 25,"minute" => 30),
	"17" => array("hour" => 26,"minute" => 0),
	"18" => array("hour" => 26,"minute" => 30),
	"19" => array("hour" => 27,"minute" => 0),
	"20" => array("hour" => 27,"minute" => 30),
	"21" => array("hour" => 28,"minute" => 0),
	"22" => array("hour" => 28,"minute" => 30),
	"23" => array("hour" => 29,"minute" => 0),
	"24" => array("hour" => 29,"minute" => 30),
	"25" => array("hour" => 30,"minute" => 0),
	"26" => array("hour" => 30,"minute" => 30),
	"27" => array("hour" => 31,"minute" => 0),
	"28" => array("hour" => 31,"minute" => 30),
	"29" => array("hour" => 32,"minute" => 0),
	"30" => array("hour" => 32,"minute" => 30),
	"31" => array("hour" => 33,"minute" => 0)
);

		//$time_array = get_time_array_common();
//		include(COMMON_INC."time_array.php");
		require_once(COMMON_INC."time_array.php");

		if( $staff_type == "honbu" ){

			$time_array = $time_array_honbu;

		}else{

			$time_array = $time_array_driver;

		}
echo "<pre>"; print_r($time_array); echo "</pre>";

		$time_data = get_time_value_for_sale_driver_one_common($time_array,$start_time,$end_time);

		$start_hour = $time_data["start_hour"];
		$start_minute = $time_data["start_minute"];
		$end_hour = $time_data["end_hour"];
		$end_minute = $time_data["end_minute"];
echo $start_time . ", " . $end_time . " " . $end_hour . ":" . $end_minute . "<br />";
exit;

		include(COMMON_INC."db_connect.php");

//売上金額の更新
$sql = sprintf("
update attendance_staff_new set start_hour='%s',start_minute='%s',end_hour='%s',end_minute='%s' where id='%s'",
$start_hour,$start_minute,$end_hour,$end_minute,$attendance_id);

		//$res = mysql_query($sql, $con);

		if($res == false){

			echo "error!(get_and_update_driver_work_time_common)";
			exit();

		}

	}

	$data["start_hour"] = $start_hour;
	$data["start_minute"] = $start_minute;
	$data["end_hour"] = $end_hour;
	$data["end_minute"] = $end_minute;

	return $data;
	exit();

}
?>

<?php

include("include/common.php");
include("include/auth.php");



if( isset($_GET["area"])==true ){

	$area = $_GET["area"];

}else{

	$area = "all";

}

$page_area = $area;

if( (isset($_GET["year"])==true) && (isset($_GET["month"])==true) && (isset($_GET["day"])==true) ){
	
	$year = $_GET["year"];
	$month = $_GET["month"];
	$day = $_GET["day"];
	
}else{
	
	$year = intval(date("Y"));
	$month = intval(date("m"));
	$day = intval(date("d"));
	
}

$day_select_frm = get_sale_shop_day_select_frm($area,$year,$month,$day);

$week_name = get_week_name_by_time_common($year, $month, $day);

if( ($month != "-1") && ($day != "-1") ){
	
	$day_disp = sprintf("%s月%s日（%s）",$month,$day,$week_name);
	
}else{
	
	$day_disp = "日付を選択してください";
	
}

$shop_data = get_shop_data($area);

$shop_data_num = count($shop_data);

//$month_select_frm = get_sale_shop_month_select_frm($area,$year,$month);
$type = "shop";
$month_select_frm = get_sale_month_select_frm_common($area,$year,$month,$type);

$url_para_add = sprintf("area=%s&year=%s&month=%s&day=%s",$area,$year,$month,$day);

/*
echo "<pre>";
print_r($driver_data);
echo "</pre>";
exit();
*/

?>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>店舗別売上 | 管理</title>
<script type="text/javascript" src="../js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="js/sale_shop.js"></script>
<link href="style.css" rel="stylesheet" type="text/css" />
<link href="css/sale_shop.css" rel="stylesheet" type="text/css" />

</head>

<body>
<div style="margin:0px 0px 0px 0px;" id="wrapper">

<div>
	<a href="index.php">管理トップ</a> &gt; <a href="sale.php">売上・ポイント</a> &gt; 店舗別売上
</div>

<div style="padding:0px 0px 100px 30px;">

<?php include("include/sale_menu.php");?>

<div>
	<input type="hidden" name="area" value="<?php echo $area;?>" id="sale_driver_area_val" />
</div>

<div style="padding:10px 0px 0px 0px;">
	<div id="sale_driver_day_select_area" style="float:left;">
		<?php echo $day_select_frm;?>
	</div>
	<div style="float:left;padding-left:30px;">
		<?php echo $month_select_frm;?>
	</div>
	<div style="float:left;padding-left:30px;">
		○<a href="sale_change_history.php?type=shop&<?php echo $url_para_add;?>">修正履歴</a>
	</div>
	
	<br class="clear" />
</div>

<div style="padding:20px 0px 0px 0px;">
	<div style="float:left;">
		<?php echo $day_disp;?>
	</div>
	<div style="float:left;padding-left:30px;">
<?php

$url_para = sprintf("&year=%s&month=%s&day=%s",$year,$month,$day);

if( $area == "all" ){

	echo '<b>全体</b>　';
	echo '<a href="sale_shop.php?area=tokyo'.$url_para.'">東京</a>　';
	echo '<a href="sale_shop.php?area=yokohama'.$url_para.'">横浜</a>　';
	echo '<a href="sale_shop.php?area=sapporo'.$url_para.'">札幌</a>　';
	echo '<a href="sale_shop.php?area=sendai'.$url_para.'">仙台</a>　';
	echo '<a href="sale_shop.php?area=osaka'.$url_para.'">大阪</a>　';

}else if( $area == "tokyo" ){

	echo '<a href="sale_shop.php?area=all'.$url_para.'">全体</a>　';
	echo '<b>東京</b>　';
	echo '<a href="sale_shop.php?area=yokohama'.$url_para.'">横浜</a>　';
	echo '<a href="sale_shop.php?area=sapporo'.$url_para.'">札幌</a>　';
	echo '<a href="sale_shop.php?area=sendai'.$url_para.'">仙台</a>　';
	echo '<a href="sale_shop.php?area=osaka'.$url_para.'">大阪</a>　';

}else if( $area == "yokohama" ){

	echo '<a href="sale_shop.php?area=all'.$url_para.'">全体</a>　';
	echo '<a href="sale_shop.php?area=tokyo'.$url_para.'">東京</a>　';
	echo '<b>横浜</b>　';
	echo '<a href="sale_shop.php?area=sapporo'.$url_para.'">札幌</a>　';
	echo '<a href="sale_shop.php?area=sendai'.$url_para.'">仙台</a>　';
	echo '<a href="sale_shop.php?area=osaka'.$url_para.'">大阪</a>　';

}else if( $area == "sapporo" ){

	echo '<a href="sale_shop.php?area=all'.$url_para.'">全体</a>　';
	echo '<a href="sale_shop.php?area=tokyo'.$url_para.'">東京</a>　';
	echo '<a href="sale_shop.php?area=yokohama'.$url_para.'">横浜</a>　';
	echo '<b>札幌</b>　';
	echo '<a href="sale_shop.php?area=sendai'.$url_para.'">仙台</a>　';
	echo '<a href="sale_shop.php?area=osaka'.$url_para.'">大阪</a>　';

}else if( $area == "sendai" ){

	echo '<a href="sale_shop.php?area=all'.$url_para.'">全体</a>　';
	echo '<a href="sale_shop.php?area=tokyo'.$url_para.'">東京</a>　';
	echo '<a href="sale_shop.php?area=yokohama'.$url_para.'">横浜</a>　';
	echo '<a href="sale_shop.php?area=sapporo'.$url_para.'">札幌</a>　';
	echo '<b>仙台</b>　';
	echo '<a href="sale_shop.php?area=osaka'.$url_para.'">大阪</a>　';

}else if( $area == "osaka" ){

	echo '<a href="sale_shop.php?area=all'.$url_para.'">全体</a>　';
	echo '<a href="sale_shop.php?area=tokyo'.$url_para.'">東京</a>　';
	echo '<a href="sale_shop.php?area=yokohama'.$url_para.'">横浜</a>　';
	echo '<a href="sale_shop.php?area=sapporo'.$url_para.'">札幌</a>　';
	echo '<a href="sale_shop.php?area=sendai'.$url_para.'">仙台</a>　';
	echo '<b>大阪</b>　';

}

?>
	</div>
	<br class="clear" />
</div>

<div id="table_wrapper">

<div id="table_title">

	<div class="cel_7">店舗</div>
	<div class="cel_10">売上</div>
	<div class="cel_4">
		<div class="tb_title">セラピスト</div>
		<div>
			<div class="cel_1_3">
				<div class="cel_dan">未払い報酬</div>
				<div class="cel_dan">日払い報酬</div>
			</div>
			<div class="cel_1_4">
				<div class="cel_dan">最低保証</div>
				<div class="cel_dan">手当合計</div>
			</div>
			<div class="cel_1_4_2">報酬合計</div>
			<br class="clear" />
		</div>
	</div>
	
	<div class="cel_17">
		<div class="tb_title">内勤スタッフ</div>
		<div>
			<div class="cel_1_3">
				<div class="cel_dan">未払い報酬</div>
				<div class="cel_dan">日払い報酬</div>
			</div>
			<div class="cel_1_4_2">手当合計</div>
			<div class="cel_1_4_2">報酬合計</div>
			<br class="clear" />
		</div>
	</div>
	
	<div class="cel_12">
		<div class="tb_title">ドライバー</div>
		<div>
			<div class="cel_1_3">
				<div class="cel_dan">未払い報酬</div>
				<div class="cel_dan">日払い報酬</div>
			</div>
			<div class="cel_1_4_2">手当合計</div>
			<div class="cel_1_4_2">報酬合計</div>
			<br class="clear" />
		</div>
	</div>
	
	<div class="cel_5">
		<div class="tb_title">移動費</div>
		<div>
			<div class="cel_1_5_2">移動実費</div>
			<div class="cel_1_4_2">ガソリン代</div>
			<div class="cel_1_4">
				<div class="cel_dan">駐車場代</div>
				<div class="cel_dan">高速代</div>
			</div>
			<div class="cel_1_4_2">清算済み</div>
			<br class="clear" />
		</div>
	</div>
	<div class="cel_13">
		<div class="tb_title">諸経費</div>
		<div>
			<div class="cel_1_5_2">カード手数料</div>
			<div class="cel_1_4_2">店長報酬</div>
			<div class="cel_1_4_2">その他<br />(社用車)</div>
		</div>
	</div>
	<div class="cel_8">粗利益</div>
	<br class="clear" />
	
</div>

<?php

$therapist_remuneration_all = 0;
$price_all = 0;
$card_commission_all = 0;
$gross_profit_all = 0;
$shop_boss_remuneration_all = 0;
$driver_remuneration_all = 0;
$movement_cost_all = 0;
$driver_gasoline_all = 0;
$driver_parking_all = 0;
$lowest_guarantee_all = 0;
$driver_allowance_all = 0;
$driver_highway_all = 0;
$driver_pay_finish_all = 0;
$driver_sonota_all = 0;
$genkin_price_all = 0;
$card_price_all = 0;
$pay_day_therapist_all = 0;
$therapist_remuneration_mibarai_all = 0;
$allowance_therapist_all = 0;
$pay_day_driver_all = 0;
$driver_remuneration_mibarai_all = 0;
$therapist_remuneration_sum_all = 0;
$driver_remuneration_sum_all = 0;

$office_remuneration_mibarai_all = 0;
$pay_day_office_all = 0;
$office_allowance_all = 0;
$office_remuneration_sum_all = 0;

for($i=0;$i<$shop_data_num;$i++){
	
	$movement_cost_disp_flg = false;
	
	$shop_id = $shop_data[$i]["id"];
	$shop_name = $shop_data[$i]["name"];
	$shop_area = $shop_data[$i]["area"];
	
	$data = get_sale_shop_2_data_day($year,$month,$day,$shop_name,$shop_area);
	
	$genkin_price = $data["genkin_price"];
	$card_price = $data["card_price"];
	$card_commission = $data["card_commission"];
	$therapist_remuneration = $data["therapist_remuneration"];
	$pay_day_therapist = $data["pay_day_therapist"];
	$therapist_remuneration_mibarai = $data["therapist_remuneration_mibarai"];
	$allowance_jisou = $data["allowance_jisou"];
	$allowance_therapist = $data["allowance_therapist"];
	$driver_remuneration = $data["driver_remuneration"];
	$driver_gasoline = $data["driver_gasoline"];
	$driver_parking = $data["driver_parking"];
	$driver_allowance = $data["driver_allowance"];
	$driver_highway = $data["driver_highway"];
	$driver_pay_finish = $data["driver_pay_finish"];
	$lowest_guarantee = $data["lowest_guarantee"];
	$therapist_remuneration_sum = $data["therapist_remuneration_sum"];
	$pay_day_driver = $data["pay_day_driver"];
	$driver_remuneration_mibarai = $data["driver_remuneration_mibarai"];
	$driver_remuneration_sum = $data["driver_remuneration_sum"];
	$movement_cost = $data["movement_cost"];
	$shop_boss_remuneration = $data["shop_boss_remuneration"];
	$driver_sonota = $data["driver_sonota"];
	$gross_profit = $data["gross_profit"];
	$office_remuneration_mibarai = $data["office_remuneration_mibarai"];
	$pay_day_office = $data["pay_day_office"];
	$office_allowance = $data["office_allowance"];
	$office_remuneration_sum = $data["office_remuneration_sum"];
	
	$genkin_price_all = $genkin_price_all + $genkin_price;
	$card_price_all = $card_price_all + $card_price;
	$price_all = $price_all + $genkin_price + $card_price;
	$card_commission_all = $card_commission_all + $card_commission;
	$pay_day_therapist_all = $pay_day_therapist_all + $pay_day_therapist;
	$therapist_remuneration_mibarai_all = $therapist_remuneration_mibarai_all + $therapist_remuneration_mibarai;
	$allowance_therapist_all = $allowance_therapist_all + $allowance_therapist;
	$therapist_remuneration_sum_all = $therapist_remuneration_sum_all + $therapist_remuneration_sum;
	$driver_remuneration_sum_all = $driver_remuneration_sum_all + $driver_remuneration_sum;
	$lowest_guarantee_all = $lowest_guarantee_all + $lowest_guarantee;
	$pay_day_driver_all = $pay_day_driver_all + $pay_day_driver;
	$therapist_remuneration_all = $therapist_remuneration_all + $therapist_remuneration;
	$driver_remuneration_mibarai_all = $driver_remuneration_mibarai_all + $driver_remuneration_mibarai;
	$driver_remuneration_all = $driver_remuneration_all + $driver_remuneration;
	$movement_cost_all = $movement_cost_all + $movement_cost;
	$driver_gasoline_all = $driver_gasoline_all + $driver_gasoline;
	$driver_parking_all = $driver_parking_all + $driver_parking;
	$driver_allowance_all = $driver_allowance_all + $driver_allowance;
	$driver_highway_all = $driver_highway_all + $driver_highway;
	$driver_pay_finish_all = $driver_pay_finish_all + $driver_pay_finish;
	$office_remuneration_mibarai_all = $office_remuneration_mibarai_all + $office_remuneration_mibarai;
	$pay_day_office_all = $pay_day_office_all + $pay_day_office;
	$office_allowance_all = $office_allowance_all + $office_allowance;
	$office_remuneration_sum_all = $office_remuneration_sum_all + $office_remuneration_sum;
	$shop_boss_remuneration_all = $shop_boss_remuneration_all + $shop_boss_remuneration;
	$driver_sonota_all = $driver_sonota_all + $driver_sonota;
	$gross_profit_all = $gross_profit_all + $gross_profit;
	
	if( $shop_area == "tokyo" ){
	
		if( $shop_name != "東京リフレ" ){
			
			$movement_cost_disp_flg = true;
				
		}
	
	}else if( $shop_area == "osaka" ){
		
		if( $shop_name != "大阪リフレ" ){
		
			$movement_cost_disp_flg = true;
		
		}
		
	}
	
?>
	
<div>

<div class="cel_1_2" style="text-align:left;">
<?php echo $shop_name;?>
</div>

<div class="cel_11">

<div>

<div class="cel_2">
現金
</div>
<div class="cel_6">
<?php echo number_format($genkin_price);?>
</div>
<br class="clear" />

</div>

<div>

<div class="cel_2_2">
カード
</div>
<div class="cel_6_2">
<div class="padding_common"><?php echo number_format($card_price);?></div>
</div>
<br class="clear" />

</div>

</div>

<div class="cel_1_6">
<div class="cel_dan_2">
<?php echo number_format($therapist_remuneration_mibarai);?>
</div>
<div class="cel_dan_3">
<?php echo number_format($pay_day_therapist);?>
</div>
</div>

<div class="cel_1_7">
<div class="cel_dan_2">
<?php echo number_format($lowest_guarantee);?>
</div>
<div class="cel_dan_3">
<?php echo number_format($allowance_therapist);?>
</div>
</div>

<div class="cel_1_7">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($therapist_remuneration_sum);?></span>
</div>
</div>



<div class="cel_1_6">
<div class="cel_dan_2">
<?php echo number_format($office_remuneration_mibarai);?>
</div>
<div class="cel_dan_3">
<?php echo number_format($pay_day_office);?>
</div>
</div>
<div class="cel_1_7">
<div class="padding_common"><?php echo number_format($office_allowance);?></div>
</div>
<div class="cel_1_7">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($office_remuneration_sum);?></span>
</div>
</div>



<div class="cel_1_6">
<div class="cel_dan_2">
<?php echo number_format($driver_remuneration_mibarai);?>
</div>
<div class="cel_dan_3">
<?php echo number_format($pay_day_driver);?>
</div>
</div>
<div class="cel_1_7">
<div class="padding_common"><?php echo number_format($driver_allowance);?></div>
</div>
<div class="cel_1_7">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($driver_remuneration_sum);?></span>
</div>
</div>



<div class="cel_1_6">

<div class="padding_common">
<form id="movement_cost_frm_<?php echo $shop_id;?>">
<input type="hidden" name="shop_area" value="<?php echo $shop_area;?>" />
<input type="hidden" name="page_area" value="<?php echo $page_area;?>" />
<input type="hidden" name="year" value="<?php echo $year;?>" />
<input type="hidden" name="month" value="<?php echo $month;?>" />
<input type="hidden" name="day" value="<?php echo $day;?>" />
<div class="td_movement_cost" id="movement_cost_<?php echo $shop_id;?>">

<?php if( $movement_cost_disp_flg == true ){
echo '<div class="td_disp" id="movement_cost_disp_'.$shop_id.'">';
echo number_format($movement_cost);
echo '</div>';
}else{
//echo '<div class="td_hidden" id="movement_cost_hidden_'.$shop_id.'">';
//echo '<input type="text" name="frm_val" value="'.$movement_cost.'" class="form_txt" id="movement_cost_txt_'.$shop_id.'" />';
//echo '</div>';
echo '<div class="td_disp" id="movement_cost_disp_'.$shop_id.'">';
echo number_format($movement_cost);
echo '</div>';
}
?>

</div>
</form>
</div>

</div>

<div class="cel_1_7">
<div class="padding_common">
<?php echo number_format($driver_gasoline);?>
</div>
</div>

<div class="cel_1_7">
<div class="cel_dan_2">
<?php echo number_format($driver_parking);?>
</div>
<div class="cel_dan_3">
<?php echo number_format($driver_highway);?>
</div>
</div>

<div class="cel_1_7">
<div class="padding_common"><?php echo number_format($driver_pay_finish);?></div>
</div>
<div class="cel_1_6">
<div class="padding_common"><?php echo number_format($card_commission);?></div>
</div>
<div class="cel_1_7">
<div class="padding_common"><?php echo number_format($shop_boss_remuneration);?></div>
</div>
<div class="cel_1_7">
<div class="padding_common"><?php echo number_format($driver_sonota);?></div>
</div>
	
<div class="cel_9">

<div id="gross_profit_<?php echo $shop_id;?>">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($gross_profit);?></span>
</div>
</div>

</div>

<br class="clear" />

</div>

<?php

}

?>


<?php if( ($area=="all") || ($area=="tokyo") ){ ?>

<div>

<div class="cel_14_3" style="text-align:left;">合計</div>

<div class="cel_15">

<div>
<div class="cel_2">
現金
</div>
<div class="cel_6">
<?php echo number_format($genkin_price_all);?>
</div>
<br class="clear" />
</div>

<div>
<div class="cel_2_4">
カード
</div>
<div class="cel_6_3">
<?php echo number_format($card_price_all);?>
</div>
<br class="clear" />
</div>

<div>
<div class="cel_2_3">
合計
</div>
<div class="cel_6">
<?php echo number_format($price_all);?>
</div>
<br class="clear" />
</div>

</div>

<div class="cel_3">

<div class="cel_14">
<div class="cel_dan_2">
<?php echo number_format($therapist_remuneration_mibarai_all);?>
</div>
<div class="cel_dan_2">
<?php echo number_format($pay_day_therapist_all);?>
</div>
<div class="cel_dan_4">
&nbsp;
</div>
</div>
<div class="cel_14_2">
<div class="cel_dan_2">
<?php echo number_format($lowest_guarantee_all);?>
</div>
<div class="cel_dan_2">
<?php echo number_format($allowance_therapist_all);?>
</div>
<div class="cel_dan_4">
&nbsp;
</div>
</div>
<div class="cel_14_2">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($therapist_remuneration_sum_all);?></span>
</div>
</div>



<div class="cel_14">
<div class="cel_dan_2">
<?php echo number_format($office_remuneration_mibarai_all);?>
</div>
<div class="cel_dan_2">
<?php echo number_format($pay_day_office_all);?>
</div>
<div class="cel_dan_4">
&nbsp;
</div>
</div>
<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($office_allowance_all);?></div>
</div>
<div class="cel_14_2">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($office_remuneration_sum_all);?></span>
</div>
</div>



<div class="cel_14">
<div class="cel_dan_2">
<?php echo number_format($driver_remuneration_mibarai_all);?>
</div>
<div class="cel_dan_2">
<?php echo number_format($pay_day_driver_all);?>
</div>
<div class="cel_dan_4">
&nbsp;
</div>
</div>
<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($driver_allowance_all);?></div>
</div>
<div class="cel_14_2">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($driver_remuneration_sum_all);?></span>
</div>
</div>



<div class="cel_14">
<div class="padding_common"><?php echo number_format($movement_cost_all);?></div>
</div>
<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($driver_gasoline_all);?></div>
</div>
<div class="cel_14_2">
<div class="cel_dan_2">
<?php echo number_format($driver_parking_all);?>
</div>
<div class="cel_dan_2">
<?php echo number_format($driver_highway_all);?>
</div>
<div class="cel_dan_4">
&nbsp;
</div>
</div>

<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($driver_pay_finish_all);?></div>
</div>
<div class="cel_14">
<div class="padding_common"><?php echo number_format($card_commission_all);?></div>
</div>
<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($shop_boss_remuneration_all);?></div>
</div>
<div class="cel_14_2">
<div class="padding_common"><?php echo number_format($driver_sonota_all);?></div>
</div>
<div class="cel_16">
<div class="padding_common">
<span class="font_bold"><?php echo number_format($gross_profit_all);?></span>
</div>
</div>

<br class="clear" />

</div>

<br class="clear" />

</div>

<?php } ?>

</div>

</div>

</div>
</body>
</html>
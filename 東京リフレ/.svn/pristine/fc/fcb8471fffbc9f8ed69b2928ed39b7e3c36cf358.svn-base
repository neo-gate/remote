<?php
/* =================================================================================
		Script Name	auth.php( 認証チェック )
		Update Date	2018/02/09	管理者権限以外のメニューの為に変更 by aida
================================================================================= */

	// ログイン状態かどうかのチェック
	if ( ( $_SESSION["ticket_man"] != md5(TICKET_WORD.$_SESSION["login_staff_name_man"]) ) || ( $_SESSION["login_staff_login_auth_type"] == "" ) ) {
	
		//オートログインチェック
		$result = check_auto_login_2();
	
		if( $result == false ){
				
			//アクセスしたページのURLを取得
			$access_page_url = "http://" . $_SERVER["HTTP_HOST"] . $_SERVER["REQUEST_URI"];
				
			$file_name = basename($_SERVER['PHP_SELF']);
				
			$_SESSION["access_page_url"] = $access_page_url;
				
			// ログインページにリダイレクト
			header("Location: ".WWW_URL_MAN."login.php");
			exit();
	
		}
		
	}
	
	$login_staff_login_auth_type = $_SESSION["login_staff_login_auth_type"];
	$login_staff_area = $_SESSION["login_staff_area"];
	
	$file_name = basename($_SERVER['PHP_SELF']);
	$area_auth = $_GET["area"];
	if( $area_auth == "" ){
		$area_auth = $_POST["area"];
	}
	
	if( $login_staff_login_auth_type == "1" ) {
		
		//何もなし
	}else if( $login_staff_login_auth_type == "2" ){
		if(preg_match("/fixtures\/index\.php/", $_SERVER['PHP_SELF'])) {
			$result = true;
			$area_admin_flg = true;
		} else {
			$result = allow_url_check_2($login_staff_login_auth_type,$login_staff_area,$file_name,$area_auth);
		}
		if( $result === false ){
			//header("Location: staff_calendar_new.php?area=".$login_staff_area);
			header("Location: " . WWW_URL_MAN . "stf_calendar.php?area=".$login_staff_area);		//update by aida at 20180209
			exit();
		}
		
	}else if( $login_staff_login_auth_type == "3" ){
		
		$result = allow_url_check_2($login_staff_login_auth_type,$login_staff_area,$file_name,$area_auth);
		if( $result === false ){
			//header("Location: staff_calendar_new.php?area=".$login_staff_area);
			header("Location: " . WWW_URL_MAN . "stf_calendar.php?area=".$login_staff_area);		//update by aida at 20180209
			exit();
		}
		
	}else if( $login_staff_login_auth_type == "4" ){
		
		$result = allow_url_check_2($login_staff_login_auth_type,$login_staff_area,$file_name,$area_auth);
		if( $result === false ){
			//header("Location: staff_calendar_new.php?area=".$login_staff_area);
			header("Location: " . WWW_URL_MAN . "stf_calendar.php?area=".$login_staff_area);		//update by aida at 20180209
			exit();
		}
	}else if( $login_staff_login_auth_type == "5" ){
		
		$result = allow_url_check_2($login_staff_login_auth_type,$login_staff_area,$file_name,$area_auth);
		if( $result === false ){
			//header("Location: reservation_status_board.php?area=".$login_staff_area);
			header("Location: " . WWW_URL_MAN . "rs_sts_board.php?area=".$login_staff_area);				//update by aida at 20180209
			exit();
		}
		
	}else if( $login_staff_login_auth_type == "6" ){
		
		$result = allow_url_check_2($login_staff_login_auth_type,$login_staff_area,$file_name,$area_auth);
		if( $result === false ){
			//header("Location: staff_calendar_kensyuu.php?area=".$login_staff_area);
			header("Location: " . WWW_URL_MAN . "stf_calendar.php?area=kensyuu");		//update by aida at 20180209
			exit();
		}
		
	}else{
		
		go_to_login_page_action();
		
	}

	$all_page_flg = get_all_page_flg($login_staff_login_auth_type);


?>